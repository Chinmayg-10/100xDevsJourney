<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Reporter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #map {
            height: 350px;
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <!-- Main Content Container -->
    <div class="max-w-xl mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Civic Reporter</h1>
        <p class="text-gray-600 mb-6">Find your location on the map.</p>
        
        <!-- Map Container -->
        <div id="map"></div>

        <!-- Message Box -->
        <div id="message-box" class="mt-6 p-4 rounded-lg text-sm transition-all duration-300 hidden"></div>

    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <script>
        // Use a function to show messages
        function showMessage(text, type = 'info') {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = text;
            msgBox.classList.remove('hidden', 'bg-red-200', 'text-red-800', 'bg-blue-200', 'text-blue-800');
            if (type === 'error') {
                msgBox.classList.add('bg-red-200', 'text-red-800');
            } else {
                msgBox.classList.add('bg-blue-200', 'text-blue-800');
            }
        }

        // Initialize the map with a default view
        var map = L.map('map').setView([51.505, -0.09], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        let marker, circle;
        let zoomed = false;

        // Use watchPosition to track the user's location
        navigator.geolocation.watchPosition(success, error, {
            enableHighAccuracy: true,
        });

        function success(pos) {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const accuracy = pos.coords.accuracy;

            // Remove existing layers to avoid duplicates
            if (marker) {
                map.removeLayer(marker);
                map.removeLayer(circle);
            }

            // Add new marker and circle
            marker = L.marker([lat, lng]).addTo(map);
            circle = L.circle([lat, lng], { radius: accuracy, color: '#3b82f6', fillColor: '#93c5fd', fillOpacity: 0.5 }).addTo(map);

            // Use flyTo for a smooth animation to the location, but only the first time
            if (!zoomed) {
                map.flyTo([lat, lng], 16); // A smooth animation to the user's location with a zoom level of 16
                zoomed = true;
                showMessage("Your location has been found!", 'info');
            }
        }

        function error(err) {
            if (err.code === 1) {
                showMessage("Please allow geolocation access to view your location.", 'error');
            } else {
                showMessage("Cannot get current location. Please check your device settings.", 'error');
            }
        }
    </script>
</body>
</html>
